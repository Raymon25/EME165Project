clear;

%This script makes use of numerically substitued energy equations acquired
%from EquationSolver.m. For readable energy balance equations see
%EquationSOlver.m.

%Creates and assigns values to variables for propety values

k = 80; %W/m-K
h_water = 1000; %W/m^2-K
h_air = 25; %W/m^2-K
Q = 10^6; %W/m^2
a = 0.95;
e = 0.75;
sb = 5.67*10^-8;
r_i = 15 * 10^(-3); %m
r_o = 18 * 10^(-3); %m
T_inf = 40; %C
T_water = 600; %C
T_surr = 40; %C
r_avg = (r_i + r_o)/2; %m 

%Creates matrix of control volumes

rows = 2; %number of control volumes in radial direction (surface film & ceramic wall)
columns = 36; %number of control volumes in angular drection (minimum of 20)

d_theta = pi/columns; %change in angle between control volumes
Temp = ones(rows,columns)*700; %Cavg_fractionontrol volume matrix w/ initial guess of 700 C

%Set resistance values
c_o =r_o * d_theta; %m
c_i =r_i * d_theta; %m
R_contact = 10^(-4); %m^2 K/W
R_cond = (r_avg * d_theta)/(k*(r_o-r_i)); %m^2 K/W
R_conv_o = 1/(h_air*c_o); %m^2 K/W
R_conv_i = 1/(h_water*c_i); %m^2 K/W

%Determines average fraction of solar energy that is recieved for each control volume

avg_fraction = zeros(1,columns);
for i = 1:columns/2
    avg_fraction(i) = integral(@(x) cos(x),(i-1)*d_theta,i*d_theta)/d_theta;
end

%Sets up variables used in iteration

new = ones(rows,columns);
done = 1;
done2 = 1;
count = 0;
count2 = 0;
sols = zeros(4,1);

tic
%Main iteration loop for part a.

while done

    for i = 1:columns/2
        Temp_under_surface = Temp(2,i);
        fraction = avg_fraction(i);

        new(1,i) = (1119953347504425625*Temp_under_surface)/1119957745550936729 + (851164544103363475*pi*fraction)/17919323928814987664 + 175921860444160/1119957745550936729;
    end

    for i = columns/2+1:columns
        new(1,i) = Temp(2,i);
    end

    for i = 1
        Temp_surface = Temp(1,i);
        Temp_cond_higher = Temp(2,i+1);

        new (2,i) = (10000*Temp_surface + (5760*Temp_cond_higher)/(11*pi) + 5404319552844595200/6880993367067191)/(5760/(11*pi) + 68818940869926650992/6880993367067191);
    end

    for i = 2:columns-1
        Temp_surface = Temp(1,i);
        Temp_cond_higher = Temp(2,i+1);
        Temp_cond_lower = Temp(2,i-1);

        new (2,i) = (10000*Temp_surface + (5760*Temp_cond_lower)/(11*pi) + (5760*Temp_cond_higher)/(11*pi) + 5404319552844595200/6880993367067191)/(11520/(11*pi) + 68818940869926650992/6880993367067191);
    end

    for i = columns
        Temp_cond_lower = Temp(2,i-1);
        Temp_surface = Temp(1,i);

        new (2,i) = (10000*Temp_surface + (5760*Temp_cond_lower)/(11*pi) + 5404319552844595200/6880993367067191)/(5760/(11*pi) + 68818940869926650992/6880993367067191);
    end
    
    done = max(abs(Temp-new),[],'all') > 10^-3;
    count = count +1;
    Temp = new;

end

count = ['Iteration Count: ', num2str(count)];
disp(count);
toc
%disp(Temp);

%Saves part a values to be plotted later.

plot1 = Temp;

tic
%Main iteration loop for part b.

while done2
    
    for i = 1:columns/2
        Temp_under_surface = Temp(2,i);
        fraction = avg_fraction(i);
        
        %Finds all roots of the equation and selects the greatest real root.

        sols(1) = - (9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)) - (12*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2) + (1386440535525292540085522174559959184935223296*6^(1/2)*(3*3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2) + 5766652075642979897673878614716138973466017743434331633760303979076151836739630624143310848/9529826042064779714679343716671806860855936955468334554841689)^(1/2))/3087041632706753716073603457883 - 9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2))^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*fraction*pi)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/4)) - 273;
        sols(2) = (12*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2) + (1386440535525292540085522174559959184935223296*6^(1/2)*(3*3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2) + 5766652075642979897673878614716138973466017743434331633760303979076151836739630624143310848/9529826042064779714679343716671806860855936955468334554841689)^(1/2))/3087041632706753716073603457883 - 9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2))^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*fraction*pi)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/4)) - (9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)) - 273;
        sols(3) = (9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)) - (12*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2) - (1386440535525292540085522174559959184935223296*6^(1/2)*(3*3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2) + 5766652075642979897673878614716138973466017743434331633760303979076151836739630624143310848/9529826042064779714679343716671806860855936955468334554841689)^(1/2))/3087041632706753716073603457883 - 9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2))^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*fraction*pi)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/4)) - 273;
        sols(4) = (9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)) + (12*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2) - (1386440535525292540085522174559959184935223296*6^(1/2)*(3*3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2) + 5766652075642979897673878614716138973466017743434331633760303979076151836739630624143310848/9529826042064779714679343716671806860855936955468334554841689)^(1/2))/3087041632706753716073603457883 - 9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*pi*fraction)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*pi*fraction)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/2))^(1/2)/(6*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(1/6)*(9*((3^(1/2)*(256*((773712524553362671811952640000*Temp_under_surface)/5168253726124329 + (36751344916284726911067750400*fraction*pi)/5168253726124329 + 126166198856685557737622038849045396071225753600/3087041632706753716073603457883)^3 + 3694919573501943149735793635834956456518649572721142933525036955869490084815755935104806401273508488594642126416672306340003125270566353840950481384917771173161935098328478128275456/272452753176048193763679825817950139078101774189195278614739423094720233785750562997373306497532106504078259004655557118163)^(1/2))/18 + 961108679273829982945646435786023162244336290572388605626717329846025306123271770690551808/85768434378583017432114093450046261747703432599215010993575201)^(2/3) - (147005379665138907644271001600*fraction*pi)/1722751242041443 - (3094850098213450687247810560000*Temp_under_surface)/1722751242041443 - 1513994386280226692851464466188544752854709043200/3087041632706753716073603457883)^(1/4)) - 273;

        sols = sols(sols==real(sols));
        
        new(1,i) = max(sols);
    end

    for i = columns/2+1:columns
        new(1,i) = Temp(2,i);
    end

    for i = 1
        Temp_surface = Temp(1,i);
        Temp_cond_higher = Temp(2,i+1);

        new (2,i) = (10000*Temp_surface + (5760*Temp_cond_higher)/(11*pi) + 5404319552844595200/6880993367067191)/(5760/(11*pi) + 68818940869926650992/6880993367067191);
    end

    for i = 2:columns-1
        Temp_surface = Temp(1,i);
        Temp_cond_higher = Temp(2,i+1);
        Temp_cond_lower = Temp(2,i-1);

        new (2,i) = (10000*Temp_surface + (5760*Temp_cond_lower)/(11*pi) + (5760*Temp_cond_higher)/(11*pi) + 5404319552844595200/6880993367067191)/(11520/(11*pi) + 68818940869926650992/6880993367067191);
    end

    for i = columns
        Temp_cond_lower = Temp(2,i-1);
        Temp_surface = Temp(1,i);

        new (2,i) = (10000*Temp_surface + (5760*Temp_cond_lower)/(11*pi) + 5404319552844595200/6880993367067191)/(5760/(11*pi) + 68818940869926650992/6880993367067191);
    end
    
    done2 = max(abs(Temp-new),[],'all') > 10^-3;
    count2 = count2 +1;
    Temp = new;

end

count2 = ['Iteration Count: ', num2str(count2)];
disp(count2);
toc
%disp(Temp);

%Generates plot.

clf;
hold on;
plot(1:d_theta*180/pi:180,plot1(2,1:columns));
plot(1:d_theta*180/pi:180,Temp(2,1:columns));
ax = gca;
title('Temperature vs. Angle');
xlabel('Angle (degrees)');
ylabel('Temperature (C)');
ax.YGrid = 'on';
legend('w/o emissions','w/ emissions');
hold off;